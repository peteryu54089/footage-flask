{% extends "main/base.html" %}
{% block head %}
    {{ super() }}
    <style>
        a {
            filter: drop-shadow(0.05em 0.05em 0.05em black);
            font-family: 'bogart-regular-trial';
        }

        .form-group {
            padding: 0 1% 0 1%;
        }

        .red-border {
            border: solid red;
        }
    </style>
{% endblock head %}
{% block title %} - Projects{% endblock title %}
{% block content %}
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #165a72;">
        <div class="container-fluid">
            <a class="navbar-brand" href="admin" style="color: #D8BF69;">Footage</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link" href="about" style="color: #E9DCB9;">About</a>
                    <a class="nav-link" href="projects" style="color: #E9DCB9;">Projects</a>
                    <a class="nav-link" href="qna" style="color: #E9DCB9;">Q&A</a>
                    <a class="nav-link" href="contact" style="color: #E9DCB9;">Contact</a>
                    <a class="nav-link" href="{{ url_for('logout') }}" style="color: #E9DCB9;">Log out</a>
                </div>
            </div>
        </div>
    </nav>
    <form action="{{ url_for('projects') }}" method="post" class="form flex-column" role="form" enctype="multipart/form-data">
        <div style="height: 1.3em;"></div>
        <div class="vertical-center" style="height: 10.8em;">
            <h1 style="color: #D8BF69;filter: drop-shadow(0.05em 0.05em 0.05em black);font-family: 'bogart-regular-trial';">Projects - I</h1>
        </div>
        <div class="row g-0" style="height: 26em;">
            <div class="col-1"></div>
            <div class="col-10" style="height: 100%;">
                <div style="height: 100%;background-color: white;border-radius: 1.5em;padding: 1em;">
                    <div class="d-flex flex-wrap justify-content-center" style="max-height: 100%;overflow: scroll;">
                        {% for image in projects1 %}
                            <div class="flex-column" style="height: 10em;width: 10em;margin: 1em;padding: 0.5em;">
                                <div class="vertical-center" style="height: 85%;">
                                    <img src="{{ url_for('static', filename='images/projects-1/' + image)}}" style="max-height: 95%; max-width: 95%;">
                                </div>
                                <div class="vertical-center" style="height: 15%;">
                                    <span class="select-projects-1" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">{{ image }}</span>
                                    <i class="fa fa-times clickable" style="color: red;font-size: 1.5em;margin-left: 0.2em;" onclick="selectProjects(1, '{{ image }}');"></i>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="col-1"></div>
        </div>
        <div style="height: 2em;"></div>
        <div class="flex-column" style="height: 3.6em;">
            <div class="row g-0" style="height: 100%;">
                <div class="col-3"></div>
                <div class="col-4 form-group vertical-center">
                    <input class="form-control" name="images1" type="file" style="width: 100%;" multiple>
                </div>
                <div class="col-2 form-group vertical-center">
                    <button class="btn btn-default btn-danger" type="button" style="width: 100%;padding: .375rem 0;" onclick="selectAllProjects(1);">
                        <i class="far fa-object-group"></i>
                    </button>
                </div>
                <div class="col-3"></div>
            </div>
        </div>
        <div style="height: 1.3em;"></div>
        <div class="vertical-center" style="height: 10.8em;">
            <h1 style="color: #D8BF69;filter: drop-shadow(0.05em 0.05em 0.05em black);font-family: 'bogart-regular-trial';">Projects - II</h1>
        </div>
        <div class="row g-0" style="height: 26em;">
            <div class="col-1"></div>
            <div class="col-10" style="height: 100%;">
                <div style="height: 100%;background-color: white;border-radius: 1.5em;padding: 1em;">
                    <div class="d-flex flex-wrap justify-content-center" style="max-height: 100%;overflow: scroll;">
                        {% for image in projects2 %}
                            <div class="flex-column" style="height: 10em;width: 10em;margin: 1em;padding: 0.5em;">
                                <div class="vertical-center" style="height: 85%;">
                                    <img src="{{ url_for('static', filename='images/projects-2/' + image)}}" style="max-height: 95%; max-width: 95%;">
                                </div>
                                <div class="vertical-center" style="height: 15%;">
                                    <span class="select-projects-2" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">{{ image }}</span>
                                    <i class="fa fa-times clickable" style="color: red;font-size: 1.5em;margin-left: 0.2em;" onclick="selectProjects(2, '{{ image }}');"></i>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="col-1"></div>
        </div>
        <div style="height: 2em;"></div>
        <div class="flex-column" style="height: 3.6em;">
            <div class="row g-0" style="height: 100%;">
                <div class="col-3"></div>
                <div class="col-4 form-group vertical-center">
                    <input class="form-control" name="images2" type="file" style="width: 100%;" multiple>
                </div>
                <div class="col-2 form-group vertical-center">
                    <button class="btn btn-default btn-danger" type="button" style="width: 100%;padding: .375rem 0;" onclick="selectAllProjects(2);">
                        <i class="far fa-object-group"></i>
                    </button>
                </div>
                <div class="col-3"></div>
            </div>
        </div>
        <div style="height: 5em;"></div>
        <div class="flex-column" style="height: 3.6em;">
            <div class="row g-0" style="height: 100%;">
                <div class="col-4 col-lg-5"></div>
                <div class="col-4 col-lg-2 form-group vertical-center">
                    <input class="btn btn-default btn-success" type="button" value="save" style="width: 100%;" onclick="delProjects();">
                </div>
                <div class="col-4 col-lg-5"></div>
            </div>
        </div>
        <div style="height: 8em;"></div>
    </form>
{% endblock content %}
{% block footer %}
    <script>
        var projects = [[], []];

        $(function() {
            $('.fa-times').on('click', function() {
                $(this).parent().parent().toggleClass('red-border');
            });
        });

        function selectProjects(id, filename) {
            if (projects[id - 1].includes(filename)) {
                let index = projects[id - 1].indexOf(filename);
                if (index > -1) {
                    projects[id - 1].splice(index, 1);
                }
            } else {
                projects[id - 1].push(filename);
            }
        }

        function selectAllProjects(id) {
            let className = '.select-projects-' + id.toString();
            $(className).parent().parent().addClass('red-border');
            $(className).each(function() {
                if (!projects[id - 1].includes($(this).text())) {
                    projects[id - 1].push($(this).text());
                }
            });
        }

        function delProjects() {
            let formData = new FormData($('form')[0]);
            formData.append('images1', $('input[name="images1"]').get(0).files[0]);
            formData.append('images2', $('input[name="images2"]').get(0).files[0]);
            formData.append('filenames', JSON.stringify({ projects1: projects[0], projects2: projects[1] }));
            $.ajax({
                url: 'projects',
                type: 'POST',
                data: formData,
                dataType: 'json',
                processData : false, 
                contentType : false,
                complete: function() {
                    location.reload();
                }
            });
            $('.btn-success').attr('disabled', true);
        }
    </script>
{% endblock footer %}
